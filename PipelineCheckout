//properties([parameters([string(defaultValue: '1', description: 'Number of users', name: 'UserCount', trim: true)])])
properties([parameters([choice(choices: ['1', '5', '10'], description: 'Number of users', name: 'usercount')])])
pipeline{
    agent any
    stages{
        stage("Git Checkout"){
            steps{
                echo '***checkout completed'
                
            }
        }
		stage("Performance Test"){
		steps{
			dir('framework'){
			//echo '***Starting jmeter test ${params.UserCount}'
			echo "Pulling changes from the branch ${params.usercount}"
			//bat 'jmeter -n -t jmeter_testplan_jenkins.jmx -JuserCount=10 -Jrampup=2 -Jduration=60 -Jkeywordss=LoginApp;CreateReservation;AddPNR -l testlog.csv'
			bat 'jmeter -n -t jmeter_testplan_jenkins.jmx -JuserCount=${params.usercount} -Jrampup=2 -Jduration=60 -Jkeywordss=LoginApp;CreateReservation;AddPNR -l testlog.csv'
			echo '***jmeter test completed'
			}
		}
		}
			stage("Publish Report"){
		steps{
		dir('framework'){
		 perfReport filterRegex: '', sourceDataFiles: 'testlog.csv'
		 }
		}
		}
    }
}
